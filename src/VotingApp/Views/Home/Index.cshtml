@model VotingApp.Models.VotingResult
@{
    ViewData["Title"] = "Voting Dashboard";
}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h2 class="text-center mb-0"><i class="fas fa-vote-yea"></i> Modern Voting System</h2>
                </div>
                <div class="card-body">
                    <p class="text-center text-muted mb-4">Cast your vote for your preferred party</p>
                    
                    <!-- Voting Section -->
                    <div class="row mb-5">
                        <div class="col-md-6">
                            <div class="card text-center border-danger h-100">
                                <div class="card-body d-flex flex-column">
                                    <h4 class="card-title text-danger">Republican</h4>
                                    <div class="mb-3">
                                        <i class="fas fa-republican fa-5x text-danger"></i>
                                    </div>
                                    <p class="card-text">Vote for the Republican Party</p>
                                    <button class="btn btn-danger btn-lg mt-auto vote-btn" 
                                            data-party="Republican">
                                        <i class="fas fa-check-circle"></i> Vote Republican
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card text-center border-primary h-100">
                                <div class="card-body d-flex flex-column">
                                    <h4 class="card-title text-primary">Democrat</h4>
                                    <div class="mb-3">
                                        <i class="fas fa-democrat fa-5x text-primary"></i>
                                    </div>
                                    <p class="card-text">Vote for the Democratic Party</p>
                                    <button class="btn btn-primary btn-lg mt-auto vote-btn" 
                                            data-party="Democrat">
                                        <i class="fas fa-check-circle"></i> Vote Democrat
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h4 class="mb-0"><i class="fas fa-chart-bar"></i> Live Results</h4>
                        </div>
                        <div class="card-body">
                            <!-- Total Votes Display -->
                            <div class="text-center mb-4">
                                <h1 class="display-1">
                                    <span class="text-danger">@Model.RepublicanVotes</span> - 
                                    <span class="text-primary">@Model.DemocratVotes</span>
                                </h1>
                                <p class="lead">Total Votes: @Model.TotalVotes</p>
                            </div>
                            
                            <!-- Progress Bars -->
                            <div class="mb-4">
                                <h5 class="text-danger"><i class="fas fa-republican"></i> Republican</h5>
                                <div class="progress" style="height: 40px;">
                                    <div class="progress-bar bg-danger" 
                                         role="progressbar" 
                                         style="width: @Model.RepublicanPercentage%"
                                         aria-valuenow="@Model.RepublicanPercentage" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                        @Model.RepublicanVotes votes (@Model.RepublicanPercentage.ToString("F1")%)
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="text-primary"><i class="fas fa-democrat"></i> Democrat</h5>
                                <div class="progress" style="height: 40px;">
                                    <div class="progress-bar bg-primary" 
                                         role="progressbar" 
                                         style="width: @Model.DemocratPercentage%"
                                         aria-valuenow="@Model.DemocratPercentage" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                        @Model.DemocratVotes votes (@Model.DemocratPercentage.ToString("F1")%)
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Auto-refresh indicator -->
                            <div class="text-center mt-4">
                                <small class="text-muted">
                                    <i class="fas fa-sync-alt"></i> Results auto-refresh every 10 seconds
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Info -->
                    <div class="text-center mt-4 text-muted">
                        <small>
                            <i class="fas fa-server"></i> Running on .NET 8.0 | 
                            <i class="fas fa-database"></i> MySQL 8.0 | 
                            <i class="fas fa-docker"></i> Docker Container | 
                            <i class="fas fa-port"></i> Port 8086
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.vote-btn').click(function() {
                const party = $(this).data('party');
                castVote(party);
            });
            
            // Auto-refresh results every 10 seconds
            setInterval(function() {
                location.reload();
            }, 10000);
        });
        
        async function castVote(party) {
            try {
                const response = await fetch('/api/voting/vote', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ 
                        userId: 1, // In real app, get from session/auth
                        party: party 
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('✅ Vote submitted successfully!');
                    location.reload(); // Refresh to show updated results
                } else {
                    alert('❌ Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Network error. Please try again.');
            }
        }
    </script>
}
